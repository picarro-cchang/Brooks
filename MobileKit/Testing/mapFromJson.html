<!doctype html>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>wkhtml2pdf Test</title>
</head>
<body>
    <div id="checkboxdiv" style="position:relative"></div>
    <div id="canvasesdiv" style="position:relative"></div>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script type="text/javascript">
    var baseData0 = [{"nx": 1, "ny": 2, "region": 0, "type": "satellite", "name": "Monterey"}, [[{"meanLat": 36.600260000000006, "satellite": false, "scale": 2, "meanLng": -121.88907499999999, "my": 574, "zoom": 17, "mx": 482}, [-121.89166, 36.59779, -121.88649, 36.60273, 964, 1148, 50, 50]], [{"meanLat": 36.600260000000006, "satellite": true, "scale": 2, "meanLng": -121.88907499999999, "my": 574, "zoom": 17, "mx": 482}, [-121.89166, 36.59779, -121.88649, 36.60273, 964, 1148, 50, 50]]]];
    var images = [];
    var contexts = [];

    function init() {
        var regionParams = baseData0[0];
        console.log(regionParams);
        for (var i=0; i<baseData0[1].length; i++) {
            baseParams = baseData0[1][i];
            var ip = baseParams[0];
            var mp = baseParams[1];
            var padX = mp[6];
            var padY = mp[7];
            var layer = i + 1;
            var image = new Image();
            var maptype = ip.satellite ? "satellite" : "map";
            var params = { center: ip.meanLat.toFixed(6) + "," + ip.meanLng.toFixed(6),
                           zoom: ip.zoom, size: ip.mx + "x" + ip.my, scale: ip.scale,
                           maptype: maptype, sensor: false };
            var url = 'http://maps.googleapis.com/maps/api/staticmap?' + $.param(params);
            console.log(ip);
            $("#checkboxdiv").append('<input id="id_check' + layer +
                                     '" type="checkbox" checked="checked">Layer ' +
                                     layer +'</input>');
            $("#canvasesdiv").append('<canvas id="id_layer' + layer +
                                     '" style="z-index:' + layer +
                                     '; position:absolute; left:0px; top:0px;"></canvas>');
            $("#id_check" + layer).data("layer", layer);
            $("#id_check" + layer).click(function() {
                var $this = $(this);
                var layer = $this.data("layer");
                if ($this.is(":checked")) $("#id_layer" + layer).show();
                else $("#id_layer" + layer).hide();
            });
            var ctx = $("#id_layer"+layer)[0].getContext("2d");
            $(image).data("context", ctx);
            contexts.push(ctx);
            image.src = url;
            images.push(image);
            $(image).load(function () {
                var $this = $(this)[0];
                var ctx = $(this).data("context");
                ctx.canvas.width = $this.width + 2 * padX;
                ctx.canvas.height = $this.height + 2 * padY;
                ctx.drawImage($this, padX, padY);
            });
        }
    }

    $(init);
</script>
</body>
</html>
